<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
    .demo{
        /* display: -webkit-box; 
        display: -moz-box;  
        white-space: pre-wrap; 
        word-wrap: break-word;
        overflow: hidden; 
        text-overflow: ellipsis; 
        -webkit-box-orient: vertical; 
        -webkit-line-clamp:2;  // 显示行数 */
            }
    </style>
</head>
<body>
        <div class="common">
            <h2>example</h2>
            <div class = "demo">
                <div class="text" id="overflowhidden">吉日兮辰良，穆将愉兮上皇；抚长剑兮玉珥[ěr]，璆[qiú]锵鸣兮琳琅；瑶席兮玉瑱[zhèn]，盍[hé]将把兮琼芳；蕙肴蒸兮兰藉，奠桂酒兮椒浆；扬枹[fú]兮拊[fǔ]鼓，疏缓节兮安歌；陈竽瑟兮浩倡；灵偃蹇[jiǎn]兮姣[jiāo]服，芳菲菲兮满堂；五音纷兮繁会，君欣欣兮乐康。浴兰汤兮沐芳，华采衣兮若英；灵连蜷兮既留，烂昭昭兮未央；謇[jiǎn]将憺[dàn]兮寿宫，与日月兮齐光；龙驾兮帝服，聊翱游兮周章；灵皇皇兮既降，猋[biāo]远举兮云中；览冀洲兮有余，横四海兮焉穷；思夫君兮太息，极劳心兮忡忡。吉日兮辰良，穆将愉兮上皇；抚长剑兮玉珥[ěr]，璆[qiú]锵鸣兮琳琅；瑶席兮玉瑱[zhèn]，盍[hé]将把兮琼芳；蕙肴蒸兮兰藉，奠桂酒兮椒浆；扬枹[fú]兮拊[fǔ]鼓，疏缓节兮安歌；陈竽瑟兮浩倡；灵偃蹇[jiǎn]兮姣[jiāo]服，芳菲菲兮满堂；五音纷兮繁会，君欣欣兮乐康。浴兰汤兮沐芳，华采衣兮若英；灵连蜷兮既留，烂昭昭兮未央；謇[jiǎn]将憺[dàn]兮寿宫，与日月兮齐光；龙驾兮帝服，聊翱游兮周章；灵皇皇兮既降，猋[biāo]远举兮云中；览冀洲兮有余，横四海兮焉穷；思夫君兮太息，极劳心兮忡忡。吉日兮辰良，穆将愉兮上皇；抚长剑兮玉珥[ěr]，璆[qiú]锵鸣兮琳琅；瑶席兮玉瑱[zhèn]，盍[hé]将把兮琼芳；蕙肴蒸兮兰藉，奠桂酒兮椒浆；扬枹[fú]兮拊[fǔ]鼓，疏缓节兮安歌；陈竽瑟兮浩倡；灵偃蹇[jiǎn]兮姣[jiāo]服，芳菲菲兮满堂；五音纷兮繁会，君欣欣兮乐康。浴兰汤兮沐芳，华采衣兮若英；灵连蜷兮既留，烂昭昭兮未央；謇[jiǎn]将憺[dàn]兮寿宫，与日月兮齐光；龙驾兮帝服，聊翱游兮周章；灵皇皇兮既降，猋[biāo]远举兮云中；览冀洲兮有余，横四海兮焉穷；思夫君兮太息，极劳心兮忡忡。吉日兮辰良，穆将愉兮上皇；抚长剑兮玉珥[ěr]，璆[qiú]锵鸣兮琳琅；瑶席兮玉瑱[zhèn]，盍[hé]将把兮琼芳；蕙肴蒸兮兰藉，奠桂酒兮椒浆；扬枹[fú]兮拊[fǔ]鼓，疏缓节兮安歌；陈竽瑟兮浩倡；灵偃蹇[jiǎn]兮姣[jiāo]服，芳菲菲兮满堂；五音纷兮繁会，君欣欣兮乐康。浴兰汤兮沐芳，华采衣兮若英；灵连蜷兮既留，烂昭昭兮未央；謇[jiǎn]将憺[dàn]兮寿宫，与日月兮齐光；龙驾兮帝服，聊翱游兮周章；灵皇皇兮既降，猋[biāo]远举兮云中；览冀洲兮有余，横四海兮焉穷；思夫君兮太息，极劳心兮忡忡。吉日兮辰良，穆将愉兮上皇；抚长剑兮玉珥[ěr]，璆[qiú]锵鸣兮琳琅；瑶席兮玉瑱[zhèn]，盍[hé]将把兮琼芳；蕙肴蒸兮兰藉，奠桂酒兮椒浆；扬枹[fú]兮拊[fǔ]鼓，疏缓节兮安歌；陈竽瑟兮浩倡；灵偃蹇[jiǎn]兮姣[jiāo]服，芳菲菲兮满堂；五音纷兮繁会，君欣欣兮乐康。浴兰汤兮沐芳，华采衣兮若英；灵连蜷兮既留，烂昭昭兮未央；謇[jiǎn]将憺[dàn]兮寿宫，与日月兮齐光；龙驾兮帝服，聊翱游兮周章；灵皇皇兮既降，猋[biāo]远举兮云中；览冀洲兮有余，横四海兮焉穷；思夫君兮太息，极劳心兮忡忡。</div>
            </div>
        </div>
        <!-- <script type="text/javascript" src="js/common.js"></script> -->
    </body>
    <script>
    window.onload = function(){
    var text = document.getElementById("overflowhidden");
    var str = text.innerHTML; 
    window.onresize = function(){
        overflowhidden("overflowhidden",3,str);
    }
    overflowhidden("overflowhidden",3,str);
}

// var overflowhidden = function(id, rows, str){
//     var text = document.getElementById(id);
//     // var style = getCSS(text);
//     // var lineHeight = style["line-height"];   //获取到line-height样式设置的值 必须要有 
//     var lineHeight = '12'
//     var at = rows*parseInt(lineHeight);      //计算包含文本的div应该有的高度
//     var tempstr = str;                       //获取到所有文本
//     text.innerHTML = tempstr;                //将所有文本写入html中
//     var len = tempstr.length;
//     var i = 0;
//     if(text.offsetHeight <= at){             //如果所有文本在写入html后文本没有溢出，那不需要做溢出处理
//         /*text.innerHTML = tempstr;*/
//     }
//     else {                                   //否则 一个一个字符添加写入 不断判断写入后是否溢出
//         var temp = "";
//         text.innerHTML = temp;
//         while(text.offsetHeight <= at){
//             temp = tempstr.substring(0, i+1);
//             i++;
//             text.innerHTML = temp;
//         }
//         var slen = temp.length;
//         tempstr = temp.substring(0, slen-1);
//         len = tempstr.length
//         text.innerHTML = tempstr.substring(0, len-6) +"...阿凡达";     //替换string后面三个字符 
//         text.height = at +"px";                                  //修改文本高度 为了让CSS样式overflow：hidden生效
//     }
    
// }

var overflowhidden = function(id, rows, str){
    var text = document.getElementById(id);
    // var style = getCSS(text);
    // var lineHeight = style["line-height"];
    var lineHeight = '24'
    var at = rows*parseInt(lineHeight);
    var tempstr = str;
    text.innerHTML = tempstr;
    var len = tempstr.length;
    var i = 0;
    if(text.offsetHeight <= at){                  //如果所有文本在写入html后文本没有溢出，那不需要做溢出处理
        /*text.innerHTML = tempstr;*/
    }
    else {                                        //否则 二分处理需要截断的文本
        var low = 0;
        var high = len;
        var middle;
        while(text.offsetHeight > at){
            middle = (low+high)/2;
            text.innerHTML = tempstr.substring(0,middle);   //写入二分之一的文本内容看是否需要做溢出处理 
            if(text.offsetHeight < at){                         //不需要 则写入全部内容看是否需要 修改low的值
                text.innerHTML = tempstr.substring(0,high);
                low = middle;
            }
            else{                                          //写入二分之一的文本内容依旧需要做溢出处理 再对这二分之一的内容的二分之一的部分做判断
                high = middle-1;                           //修改high值
            }
        }
        tempstr = tempstr.substring(0, high)+"...";
        text.innerHTML = tempstr;
        if(text.offsetHeight > at){
            tempstr = tempstr.substring(0, high-5)+"...";
        }
        text.innerHTML = tempstr;
        text.height = at +"px";
    }
}
    </script>
</html>